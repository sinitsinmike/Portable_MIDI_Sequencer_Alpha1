Alpha2 — Исправления ошибок и улучшения стабильности

Этот документ описывает изменения, внесённые в Alpha2 проекта MIDI-секвенсора Alpha1.

Alpha2 — это релиз, сфокусированный на стабильности и безопасности.
Новые функции не добавлялись.

⸻

Скоуп Alpha2 (заморожен)

Alpha2 затрагивает только следующие области:
	•	Безопасность загрузки (boot safety)
	•	Детерминированная загрузка проектов
	•	Отключение автоматической загрузки проекта при старте
	•	Гарантированный сброс RAM при загрузке проекта
	•	Устранение сценариев soft-brick при потере питания
	•	❌ Никаких новых функций или UI-изменений

⸻

Сводка исправлений

1. Безопасность загрузки (Boot Safety)

Было (Alpha1):
	•	Устройство автоматически загружало последний использованный проект при старте
	•	При потере питания во время записи или сохранения данные во flash могли повреждаться
	•	Загрузка повреждённого проекта при старте могла привести к:
	•	Чёрному экрану после boot-картинки
	•	Неработоспособности устройства без перепрошивки

Стало (Alpha2):
	•	Устройство больше не загружает проекты автоматически при старте
	•	Старт всегда происходит в безопасном, нейтральном состоянии
	•	Повреждённые или незавершённые проекты не могут привести к brick-сценарию при загрузке

Почему это важно:
	•	Устранён самый критичный режим отказа
	•	Устройство всегда загружается надёжно, независимо от предыдущих сбоев питания

⸻

2. Детерминированная загрузка (Load Determinism)

Было (Alpha1):
	•	Загрузка проекта не полностью очищала состояние в RAM
	•	При загрузке пустого проекта MIDI-события предыдущего проекта могли оставаться в памяти
	•	Результат: неожиданное воспроизведение «старых» MIDI-данных

Стало (Alpha2):
	•	Загрузка любого проекта всегда начинается с полного очищения RAM
	•	Буферы событий, индексы воспроизведения и состояние плеера сбрасываются детерминированно
	•	Пустые проекты теперь действительно пустые

Почему это важно:
	•	Поведение загрузки стало предсказуемым и повторяемым
	•	Исключено «протекание» состояния между проектами

⸻

3. Отключение авто-загрузки при старте

Было (Alpha1):
	•	Система неявно зависела от механизма «последнего проекта»
	•	Логика старта была жёстко связана с целостностью данных во flash

Стало (Alpha2):
	•	Ни один проект не загружается автоматически при старте
	•	Загрузка проекта — всегда явное действие пользователя

Почему это важно:
	•	Чёткое разделение логики старта и данных проекта
	•	Упрощение анализа ошибок и reasoning о системе

⸻

4. Сброс RAM при загрузке проекта

Было (Alpha1):
	•	Очистка RAM зависела от содержимого проекта
	•	В крайних случаях часть состояния могла сохраняться

Стало (Alpha2):
	•	RAM очищается безусловно перед любой загрузкой проекта
	•	Счётчики воспроизведения, записи и тиков сбрасываются в известное состояние

Почему это важно:
	•	Гарантированы чистые переходы состояний
	•	Исключено неопределённое поведение при воспроизведении и записи

⸻

Явно вне скоупа Alpha2

Следующие проблемы признаны, но намеренно не исправлялись в Alpha2:
	•	Clear Current Project (только RAM)
	•	Надёжность очистки при REC-during-REC
	•	Продвинутое crash-recovery
	•	Flash-журналирование или транзакционные сохранения
	•	UX или workflow-изменения

Эти пункты запланированы для будущих Alpha-релизов.

⸻

Заметки о версиях
	•	Версия формата проектов не изменялась
	•	Проекты, созданные в Alpha1, полностью совместимы
	•	Миграция или конвертация не требуется

⸻

Назначение релиза

Alpha2 предназначен для:
	•	Стабилизации ядра системы
	•	Устранения катастрофических сценариев отказа
	•	Создания безопасного фундамента для дальнейшей разработки

Alpha2 не направлен на улучшение удобства или добавление новых возможностей.

⸻

Статус: Зафиксирован
Аудитория: Внутренняя / разработчики / продвинутые пользователи